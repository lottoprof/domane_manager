<!DOCTYPE html>
<html lang="ru">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Domain Manager - Domains</title>
   <link rel="stylesheet" href="../css/style.css">
   <script src="../js/auth.js"></script>
   <script src="../js/access.js"></script>
   <script>
       // Немедленная проверка токена
       if (!localStorage.getItem('access_token')) {
           window.location.href = '../index.html';
       }
   </script>
</head>
<body style="visibility: hidden">
   <div id="header-placeholder"></div>
   <main class="main-content">
       <div class="page-container">
           <div class="table-container">
               <h2>Домены</h2>
               <div class="controls">
                   <div class="table-controls">
                       <div class="search-control">
                           <input type="text" id="searchInput" placeholder="Search...">
                       </div>
                   </div>
               </div>
               <table class="data-table">
                   <thead>
                       <tr>
                           <th rowspan="2">Expand</th>
                           <th rowspan="2">Project</th>
                           <th rowspan="2">WebSite (lang)</th>
                           <th rowspan="2">Domain</th>
                           <th rowspan="2">CDN status</th>
                           <th rowspan="2">Google</th>
                           <th rowspan="2">Yandex</th>
                           <th colspan="5">Block Details</th>
                       </tr>
                       <tr>
                           <th>CDN</th>
                           <th>Provider</th>
                           <th>WhoIs_NS</th>
                           <th>Government</th>
                           <th>Actions</th>
                       </tr>
                   </thead>
                   <tbody id="domainsTableBody">
                       <!-- Данные загружаются динамически -->
                   </tbody>
               </table>
               <button id="addDomainBtn" class="table-add-btn">+</button>
           </div>
       </div>
   </main>

   <!-- Модальное окно для добавления/редактирования домена -->
   <div id="domainModal" class="modal">
       <div class="modal-content">
           <h2 id="domainModalTitle">Новый домен</h2>
           <form id="domainForm">
               <label>Project:</label>
               <select id="domainProject" required>
                   <!-- Проекты будут загружены динамически -->
               </select>
               
               <label>Website:</label>
               <select id="domainWebsite" required>
                   <!-- Сайты будут загружены динамически -->
               </select>
               
               <label>Domain:</label>
               <input type="text" id="domainName" required>
               
               <div class="form-actions">
                   <button type="button" id="saveDomainBtn" class="btn btn-primary">Сохранить</button>
                   <button type="button" onclick="domainsManager.closeModal()" class="btn">Отмена</button>
               </div>
           </form>
       </div>
   </div>

   <script src="../js/header.js"></script>
   <script src="../js/domains.js"></script>
   <script>
       // Проверка авторизации и показ контента
       document.addEventListener('DOMContentLoaded', async () => {
           try {
               const isAuth = await Auth.checkAuth();
               if (!isAuth) {
                   window.location.href = '../index.html';
                   return;
               }
               // Показываем контент только после проверки авторизации
               document.body.style.visibility = 'visible';
           } catch {
               window.location.href = '../index.html';
           }
       });
   </script>
</body>
</html>
